(function(){var n=function(n,t){return function(){return n.apply(t,arguments)}},t={}.hasOwnProperty,i=function(n,i){function u(){this.constructor=n}for(var r in i)t.call(i,r)&&(n[r]=i[r]);return u.prototype=i.prototype,n.prototype=new u,n.__super__=i.prototype,n};c4.chart.graph=function(t){function r(){return this.unfreeze=n(this.unfreeze,this),this.freeze=n(this.freeze,this),this._style=n(this._style,this),this._draw=n(this._draw,this),this._update=n(this._update,this),this.reset=n(this.reset,this),this._size=n(this._size,this),this._init=n(this._init,this),r.__super__.constructor.apply(this,arguments)}return i(r,t),r.version=0,r.prototype.collision_separation=0,r.prototype.arrow_size=8,r.prototype.node_on=void 0,r.prototype._init=function(){var n;n=d3.geom.quadtree().x(function(n){return n.x}).y(function(n){return n.y});this.force=d3.layout.force().gravity(.2).on("tick",function(t){return function(){var r,i,u,e,f;if(t.collision_detection)for(f=t.current_nodes,u=0,e=f.length;u<e;u++)i=f[u],r=i.r+t.collision_separation/2,i.x1=i.x-r,i.x2=i.x+r,i.y1=i.y-r,i.y2=i.y+r,n(t.current_nodes).visit(function(n,r,u,f,e){var c,o,s,h;return n.point&&n.point!==i&&(s=i.x-n.point.x,h=i.y-n.point.y,o=Math.sqrt(s*s+h*h),c=i.r+n.point.r+t.collision_separation,o<c&&(o=(o-c)/(o?o:Infinity)*.5,s*=o,h*=o,i.fixed||(i.x-=s,i.y-=h),n.point.fixed||(n.point.x+=s,n.point.y+=h))),r>i.x2||f<i.x1||u>i.y2||e<i.y1});return t.circles.attr("cx",function(n){return n.x}).attr("cy",function(n){return n.y}),t.circles.each(function(n){return n.animated_r=+$(this).attr("r")}),t.lines.each(function(n){return n.radian=Math.atan2(n.target.y-n.source.y,n.target.x-n.source.x)}),t.lines.attr("x1",function(n){return n.source.x+n.source.animated_r*Math.cos(n.radian)}).attr("y1",function(n){return n.source.y+n.source.animated_r*Math.sin(n.radian)}).attr("x2",function(n){return n.target.x-(n.target.animated_r+2)*Math.cos(n.radian)}).attr("y2",function(n){return n.target.y-(n.target.animated_r+2)*Math.sin(n.radian)})}}(this));this.force.charge(function(n){return function(t){return n.value(t)/n.total_value*-n.max_r*200}}(this));this.force.linkStrength(function(n){return n.decimated?.001:1});this.force.linkDistance(function(n){return 1e3/(-(n.source.targets.length+n.target.sources.length)-16)+80});this.zoomer=d3.behavior.zoom().scaleExtent([.25,10]).on("zoom",function(n){return function(){return n.g.attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")")}}(this));this.zoomer(this.svg);this.svg.on("dblclick.zoom",null);return this.defs.append("marker").attr("id","arrow_head").attr("orient","auto").attr("refX",this.arrow_size).attr("markerWidth",this.arrow_size).attr("markerHeight",this.arrow_size).attr("viewBox","0 -5 10 10").append("path").attr("d","M0,-5L10,0L0,5"),this.defs.append("marker").attr("id","arrow_head_decimated").attr("orient","auto").attr("refX",this.arrow_size).attr("markerWidth",this.arrow_size).attr("markerHeight",this.arrow_size).attr("viewBox","0 -5 10 10").append("path").attr("d","M0,-5L10,0L0,5"),this.defs.append("marker").attr("id","arrow_head_select_path").attr("orient","auto").attr("refX",this.arrow_size).attr("markerWidth",this.arrow_size).attr("markerHeight",this.arrow_size/1.5).attr("viewBox","0 -4 8 10").append("path").attr("d","M0,-4L10,0L0,4")},r.prototype._size=function(){return this.force.size([this.width,this.height])},r.prototype.reset=function(){var n,t,r,i;for(i=this.nodes,t=0,r=i.length;t<r;t++)n=i[t],this.frozen||(n.fixed=!1),delete n.pinned,delete n.expanded;return this.circles.classed("pinned",!1),this.zoomer.scale(1).translate([0,0]),this.g.attr("transform",""),this.redraw()},r.prototype._update=function(){var wt,k,bt,f,d,i,e,n,g,r,nt,t,kt,tt,u,o,s,h,c,dt,gt,ni,ti,ii,ri,ui,fi,ei,oi,si,hi,l,a,v,y,it,p,rt,ut,ft,et,ot,st,ht,ct,lt,at,vt,yt,pt,w,b;for(this.total_value=0,rt=this.nodes,o=0,dt=rt.length;o<dt;o++)wt=rt[o],this.total_value+=this.value(wt);if(this.limit_nodes){for(g=this.nodes.slice(0),c4.array.sort_up(g,function(n){return function(t){return-n.value(t)}}(this)),this.limit_percent==null&&(this.limit_percent=0),kt=this.limit_percent*this.total_value,this.current_nodes=function(){var t,u,i,r;for(i=g.slice(0,+(this.limit_nodes-1)+1||9e9),r=[],t=0,u=i.length;t<u;t++)n=i[t],this.value(n)>kt&&r.push(n);return r}.call(this),ht=this.nodes,c=0,ri=ht.length;c<ri;c++)n=ht[c],n.visible=!1;for(ct=this.current_nodes,l=0,ui=ct.length;l<ui;l++)n=ct[l],n.visible=!0;for(i=function(n){return function(t){var r,h,c,u,f,e,o,s;if(!t.visible&&n.value(t)&&(n.current_nodes.push(t),t.visible=!0,t.expanded)){for(e=t.targets,u=0,h=e.length;u<h;u++)r=e[u],i(r);for(o=t.sources,s=[],f=0,c=o.length;f<c;f++)r=o[f],s.push(i(r));return s}}}(this),lt=this.nodes,a=0,fi=lt.length;a<fi;a++)if(n=lt[a],(n.show||n.pin)&&i(n),n.visible&&n.expanded){for(at=n.targets,v=0,ei=at.length;v<ei;v++)e=at[v],i(e);for(vt=n.sources,y=0,oi=vt.length;y<oi;y++)e=vt[y],i(e)}for(this.current_links=[],yt=this.current_nodes,f=it=0,si=yt.length;it<si;f=++it){for(n=yt[f],n.index=f,n.hidden_neighbors=!1,u={},u[this.key(n)]=!0,pt=n.targets,p=0,hi=pt.length;p<hi;p++)t=pt[p],t.visible?(this.current_links.push({source:n,target:t}),u[this.key(t)]=!0):(this.value(t)&&(n.hidden_neighbors=!0),tt=function(t){return function(i){var r,s,o,f,e;if(t.value(i)){for(o=i.targets,f=[],e=0,s=o.length;e<s;e++)(r=o[e],u[t.key(r)])||(u[t.key(r)]=!0,r.visible?f.push(t.current_links.push({source:n,target:r,decimated:!0})):f.push(tt(r)));return f}}}(this),tt(t));if(!n.hidden_neighbors)for(ft=n.sources,w=0,ni=ft.length;w<ni;w++)if(nt=ft[w],!nt.visible&&this.value(nt)){n.hidden_neighbors=!0;break}}this.limit_links&&this.current_links.length>this.limit_links&&(this.current_links=function(){var r,t,i,n;for(t=this.current_links,i=[],n=0,r=t.length;n<r;n++)d=t[n],d.decimated||i.push(d);return i}.call(this))}else if(!this.current_nodes||this.current_links)for(this.current_nodes=this.nodes,this.current_links=[],ut=this.current_nodes,s=0,gt=ut.length;s<gt;s++)for(n=ut[s],st=n.targets,h=0,ii=st.length;h<ii;h++)t=st[h],this.current_links.push({source:n,target:t});for(et=this.current_nodes,b=0,ti=et.length;b<ti;b++)n=et[b],n.r=Math.ceil(Math.sqrt(this.value(n)/this.total_value)*this.max_r),this.min_r!=null&&n.r<this.min_r&&(n.r=this.min_r);if(this.circles=this.g.selectAll("circle").data(this.current_nodes,this.key),this.lines=this.g.selectAll("line").data(this.current_links,function(n){return function(t){return n.key(t.source)+"."+n.key(t.target)}}(this)),this.new_circles=this.circles.enter().append("circle").attr("r",0).classed("pinned",function(n){return n.pin}).on("mousedown",function(){return d3.event.stopPropagation()}),this.node_title!=null&&(this.new_circles.append("title"),this.circles.selectAll("title").text(this.node_title)),this.node_on!=null){ot=this.node_on;for(k in ot){bt=ot[k];this.new_circles.on(k,bt)}}this.new_lines=this.lines.enter().insert("line",":first-child").style("opacity",0);this.circles.exit().transition().duration(750).style("opacity",0).remove();this.circles.transition().duration(0).style("opacity",.9);this.lines.exit().transition().duration(750).style("opacity",0).remove();this.lines.transition().duration(1e3).style("opacity",1);this.circles.transition().duration(2e3).attr("r",function(){return function(n){return n.r}}(this));r=this;this.force.drag().on("dragstart",function(n){var t;if(t=d3.event.sourceEvent,n.dragging=!0,n.dragstart_x=n.x,n.dragstart_y=n.y,t.which!==1||t.ctrlKey||d3.select(this).classed("pinned",!0),t.which===3&&!n.expanded&&(n.expanded="tentative",r.redraw("drag"),!n.pin))return $(this).on("mousemove.drag",function(){return d3.select(this).classed("pinned",n.x!==n.dragstart_x||n.y!==n.dragstart_y)})}).on("dragend",function(n){var t;return $(this).off("mousemove.drag"),t=d3.event.sourceEvent,n.dragging=!1,r.frozen?(n.fixed=!0,t.which===3?(n.expanded=n.expanded==="tentative",n.expanded||r.redraw("drag")):t.ctrlKey||n.x===n.dragstart_x&&n.y===n.dragstart_y&&(n.pin=!n.pin)):t.which===3?(n.x===n.dragstart_x&&n.y===n.dragstart_y?n.expanded=n.expanded==="tentative":(n.expanded=!0,n.fixed=n.pin=!0),n.expanded||r.redraw("drag")):t.ctrlKey||(n.pin=n.x===n.dragstart_x&&n.y===n.dragstart_y?!n.pin:!0,n.fixed=n.pin),d3.select(this).classed("pinned",n.pin)});this.new_circles.call(this.force.drag);this.new_circles.on("mouseenter.drag",function(n){return n.fixed=!0});return this.new_circles.on("mouseleave.drag",function(n){return function(t){if(!t.dragging)return t.fixed=n.frozen?!0:t.pin}}(this))},r.prototype._draw=function(){return this.force.nodes(this.current_nodes).links(this.current_links).start()},r.prototype._style=function(n){var u,i,t,r,f,e;if(i=n?this.new_circles:this.circles,this.node_class!=null&&i.attr("class",this.node_class),this.node_classes!=null){f=this.node_classes;for(t in f)u=f[t],i.classed(t,u)}if(this.node_color!=null&&i.style("fill",this.node_color),this.node_styles!=null&&i.style(this.node_styles),r=n?this.new_lines:this.lines,this.link_class!=null&&r.attr("class",this.link_class),this.link_classes!=null){e=this.link_classes;for(t in e)u=e[t],r.classed(t,u)}return this.link_color!=null&&r.style("stroke",this.link_color),this.link_styles!=null&&r.style(this.link_styles),this.circles.classed("hidden_neighbors",function(n){return n.hidden_neighbors}),this.lines.classed("decimated",function(n){return n.decimated})},r.prototype.freeze=function(){var r,n,u,t,i;if(this.force!=null){for(this.frozen=!0,this.force.stop(),t=this.nodes,i=[],n=0,u=t.length;n<u;n++)r=t[n],i.push(r.fixed=!0);return i}},r.prototype.unfreeze=function(){var t,n,r,i;if(this.force!=null){for(this.frozen=!1,i=this.nodes,n=0,r=i.length;n<r;n++)t=i[n],t.fixed=t.pin;return this.force.start()}},r}(c4.chart)}).call(this);
//# sourceMappingURL=c4-graph.min.js.map
