(function(){var t=function(n,t){return function(){return n.apply(t,arguments)}},i={}.hasOwnProperty,r=function(n,t){function u(){this.constructor=n}for(var r in t)i.call(t,r)&&(n[r]=t[r]);return u.prototype=t.prototype,n.prototype=new u,n.__super__=t.prototype,n},n=[].indexOf||function(n){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===n)return t;return-1};c4.chart.butterfly=function(i){function u(){this._style=t(this._style,this);this._draw=t(this._draw,this);this._update=t(this._update,this);this._size=t(this._size,this);this._init=t(this._init,this);u.__super__.constructor.apply(this,arguments);this.h=d3.scale.linear().domain([-2,2]);this.v=d3.scale.linear()}return r(u,i),u.version=0,u.prototype.node_padding_percent=1,u.prototype.link_path="line",u.prototype.link_path_curvature=.25,u.prototype.animate=!0,u.prototype.duration=1e3,u.prototype._init=function(){this.g.append("g").attr("class","links");this.g.append("g").attr("class","treasure_links");this.g.append("g").attr("class","nodes");this.g.append("g").attr("class","column_labels");this.zoomer=d3.behavior.zoom().scaleExtent([.25,10]).on("zoom",function(n){return function(){return n.g.attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")")}}(this));this.zoomer(this.svg);return this.svg.on("dblclick.zoom",null)},u.prototype._size=function(){return this.h.rangeRound([0,this.width]),this.v.range([0,this.height])},u.prototype._update=function(){var e,t,i,f,u,r,o,s,h,c,b,k,d,g,nt,l,a,v,y,p,w;if(this.center_node==null)return this.columns=[];if(r=[],u=[],e=[this.center_node],u.col=-1,e.col=0,r.col=1,u.label=this.source_label,r.label=this.target_label,this.columns=[e,r,u],this.center_node.value=this.node_value(this.center_node),this.center_node.target_links!=null)for(a=this.center_node.target_links,o=0,b=a.length;o<b;o++)i=a[o],(i.target.value=this.node_value(i.target))&&r.push(i.target);if(this.center_node.source_links!=null)for(v=this.center_node.source_links,s=0,k=v.length;s<k;s++)i=v[s],(i.source.value=this.node_value(i.source))&&u.push(i.source);for(h=0,d=r.length;h<d;h++)f=r[h],n.call(u,f)>=0&&e.push(f);for(y=this.columns,c=0,g=y.length;c<g;c++)t=y[c],t.sum=d3.sum(function(){var r,n,i;for(i=[],n=0,r=t.length;n<r;n++)f=t[n],i.push(f.value);return i}()),t.total_space=(1+this.node_padding_percent)*t.sum;for(this.v.domain([0,d3.max(function(){var u,n,i,r;for(i=this.columns,r=[],n=0,u=i.length;n<u;n++)t=i[n],r.push(t.total_space);return r}.call(this))]),p=this.columns,w=[],l=0,nt=p.length;l<nt;l++)t=p[l],t.total_space<this.v.domain()[1]&&(t.total_space+=(this.v.domain()[1]-t.total_space)/2),w.push(t.pad=(t.total_space-t.sum)/(t.length+1));return w},u.prototype._draw=function(){var r,h,f,e,nt,o,c,t,i,tt,it,rt,ut,s,l,u,yt,a,v,y,p,pt,wt,bt,kt,dt,gt,ni,ti,ii,w,b,k,d,g,ft,et,ri,ot,st,ht,ct,ui,lt,fi,at,ei,vt,oi,si,hi;for(this.current_nodes=[],this.current_links=[],tt=this.node_width/2|0,ft=this.columns,a=0,pt=ft.length;a<pt;a++)for(r=ft[a],rt=this.v(r.pad),nt=(this.v.range()[1]-this.v(r.total_space))/2+rt,v=0,wt=r.length;v<wt;v++)(i=r[v],n.call(this.current_nodes,i)<0)&&(i.butterfly_column=r.col,i.x=this.h(r.col)-tt,i.y=nt,i.dy=this.v(i.value),nt+=i.dy+rt,this.current_nodes.push(i));for(it=this.h(1)-this.h(0),et=this.columns,y=0,bt=et.length;y<bt;y++)for(r=et[y],p=0,kt=r.length;p<kt;p++){if(i=r[p],s=i.dy*this.node_padding_percent+this.v(r.pad)/2,i.target_links!=null)for(l=s/(i.target_links.length-1),e=i.y-s/2,f=i.y,lt=i.target_links,w=0,dt=lt.length;w<dt;w++)t=lt[w],t.sy=f,t.dy=this.v(this.link_value(t)),f+=t.dy,t.sx=i.x+this.node_width,(fi=t.target,n.call(this.current_nodes,fi)<0)&&(t.tx=i.x+this.node_width+it/(i.butterfly_column<1?2:1),t.ty=e),e+=t.dy+l,n.call(this.current_links,t)<0&&this.current_links.push(t);if(i.source_links!=null)for(l=s/(i.source_links.length-1),e=i.y-s/2,f=i.y,at=i.source_links,b=0,gt=at.length;b<gt;b++)t=at[b],t.ty=f,t.dy=this.v(this.link_value(t)),f+=t.dy,t.tx=i.x,(ei=t.source,n.call(this.current_nodes,ei)<0)&&(t.sx=i.x-it/(i.butterfly_column>-1?2:1),t.sy=e),e+=t.dy+l,n.call(this.current_links,t)<0&&this.current_links.push(t)}for(vt=this.current_links,k=0,ni=vt.length;k<ni;k++)t=vt[k],t.dy>t.tx-t.sx&&((oi=t.target,n.call(this.current_nodes,oi)<0)?t.tx+=t.dy-(t.tx-t.sx):(si=t.source,n.call(this.current_nodes,si)<0)&&(t.sx-=t.dy-(t.tx-t.sx))),t.sy.toFixed(3)===t.ty.toFixed(3)&&((hi=t.target,n.call(this.current_nodes,hi)<0)||(ri=t.source,n.call(this.current_nodes,ri)<0))&&(t.sy+=.001);for(ot=this.current_links,d=0,ti=ot.length;d<ti;d++)for(t=ot[d],st=this.treasure_links,g=0,ii=st.length;g<ii;g++)(u=st[g],t.source===u.source&&t.target===u.target)&&(u.sx=t.sx,u.tx=t.tx,u.sy=t.sy,u.ty=t.ty,u.dy=this.v(this.link_value(u)),this.current_links.push(u));if(this.nodes=this.g.select("g.nodes").selectAll("g").data(this.current_nodes,this.node_key),this.paths=this.g.select("g.links").selectAll("path").data(this.current_links,this.link_key),h=this.g.select("g.column_labels").selectAll("text.column_labels").data(this.columns),this.new_nodes=this.nodes.enter().append("g"),this.nodes.exit().remove(),this.new_rects=this.new_nodes.append("rect").attr("width",this.node_width),this.rects=this.nodes.selectAll("rect"),this.node_title!=null&&(this.new_rects.append("title"),this.rects.selectAll("title").text(this.node_title)),this.node_label!=null&&(this.new_labels=this.new_nodes.append("text").text(this.node_label).style("dominant-baseline","middle"),this.labels=this.nodes.selectAll("text")),this.node_on!=null){ht=this.node_on;for(o in ht){c=ht[o];this.new_nodes.on(o,c)}}if(this.new_paths=this.paths.enter().insert("path"),this.paths.exit().remove(),this.link_title!=null&&(this.new_paths.append("title"),this.paths.selectAll("title").text(this.link_title)),this.link_on!=null){ct=this.link_on;for(o in ct){c=ct[o];this.new_paths.on(o,c)}}yt=this.treasure_links;this.paths.each(function(t){if(n.call(yt,t)>=0)return this.parentNode.appendChild(this)});h.enter().append("text").attr("class","column_labels").style("text-anchor","middle").style("dominant-baseline","middle");this.animate&&(this.new_nodes.attr("transform",function(n){return function(t){return"translate("+(t.x>n.h(0)?n.width:t.x<n.h(0)-tt?-n.node_width:t.x)+","+t.y+")"}}(this)).style("opacity",0),this.new_rects.attr("height",function(n){return n.dy}),(ui=this.new_labels)!=null&&ui.attr("transform",function(n){return"translate(5,"+n.dy/2+")"}));(this.animate?this.nodes.transition().duration(this.duration):this.nodes).attr("transform",function(n){return"translate("+n.x+","+n.y+")"}).style("opacity",1);(this.animate?this.rects.transition().duration(this.duration):this.rects).attr("height",function(n){return n.dy});(this.animate?this.labels.transition().duration(this.duration):this.labels).attr("transform",function(n){return"translate(5,"+n.dy/2+")"});ut=function(n){return function(t){switch(n.link_path){case"line":return t.style("opacity",1),t.attr("d",function(n){return"M"+n.sx+","+n.sy+"L"+n.tx+","+n.ty+"L"+n.tx+","+(n.ty+n.dy)+"L"+n.sx+","+(n.sy+n.dy)+"Z"});case"curve":return t.style("opacity",1),t.style("stroke-width",function(n){return Math.max(1,n.dy)}),t.attr("d",function(t){var i,e,o,r,u,f;return i=t.tx>t.sx?n.link_path_curvature:-n.link_path_curvature*8,u=t.sy+t.dy/2,f=t.ty+t.dy/2,r=d3.interpolateRound(t.sx,t.tx),e=r(i),o=r(1-i),"M"+t.sx+","+u+"C"+e+","+u+" "+o+","+f+" "+t.tx+","+f})}}}(this);this.animate&&(ut(this.new_paths),this.new_paths.style("opacity",0));ut(this.animate?this.paths.transition().duration(this.duration):this.paths);(this.animate?h.transition().duration(this.duration):h).attr("x",function(n){return function(t){return n.h(t.col)}}(this)).attr("y",function(n){return function(t){return n.v(n.v.domain()[1]-t.total_space+t.pad)/2}}(this)).text(function(n){if(n.length)return n.label});return this.nodes.on("click",function(n){return function(t){return n.trigger("click",t)}}(this))},u.prototype._style=function(t){var i,u,r,f,e,o;if(r=t?this.new_rects:this.rects,this.node_class!=null&&r.attr("class",this.node_class),this.node_classes!=null){e=this.node_classes;for(i in e)f=e[i],r.classed(i,f)}if(this.node_color!=null&&r.style("fill",this.node_color),this.node_styles!=null&&r.style(this.node_styles),u=t?this.new_paths:this.paths,this.link_styles!=null&&u.style(this.link_styles),this.link_class!=null&&u.attr("class",this.link_class),this.paths.classed("treasure",function(t){return function(i){return n.call(t.treasure_links,i)>=0}}(this)),this.link_classes!=null){o=this.link_classes;for(i in o)f=o[i],u.classed(i,f)}return this.paths.attr("mask",function(t){return function(i){var r,u;return(r=i.source,n.call(t.current_nodes,r)<0)?"url(#mask_fade_left)":(u=i.target,n.call(t.current_nodes,u)<0)?"url(#mask_fade_right)":null}}(this))},u}(c4.chart)}).call(this);
//# sourceMappingURL=c4-butterfly.min.js.map
